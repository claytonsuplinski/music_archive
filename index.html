<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">  

	<link href="https://fonts.googleapis.com/css?family=Biryani:900" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">	
	
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="./assets/css/main.css">
</head>
<body>
<div class="header">
	<div class="hidden-sm hidden-xs"></div>
	<div class="hidden-md hidden-lg">

	</div>
</div>
<div id="content"></div>
</body>

<script src="./assets/lib/jquery.min.js"></script>

<script>
var SONG = {};

$.ajax({
	url: './assets/data/songs.json',
	dataType: 'json',
	success: function(data){
		var now = new Date();
		var christmas_condition = (now.getMonth() > 9);
		data = data.filter(function(a){
			return a.artist ||
				(a.playlist == "Christmas" && christmas_condition); 
		});
		data.sort(function(a, b){
			var a_l = (a.artist || a.playlist).toLowerCase();
			var b_l = (b.artist || b.playlist).toLowerCase();
			return (a_l > b_l ? 1 : -1);
		});
		SONG.data = data;
		data.sort(function(a, b){
			return (a.songs.length < b.songs.length ? 1 : -1);
		});
		
		SONG.ALL_SONGS = SONG.data.map(function(a){ return a.songs.map(function(b){
			b.artist = a.artist;
			b.playlist = a.playlist;
			return b;
		}); });
		
		SONG.ALL_SONGS = [].concat.apply([], SONG.ALL_SONGS).sort(function(a, b){
			var c = a.song;
			var d = b.song;
			if(a.playlist) c = a.song.split(' - ')[1];
			if(b.playlist) d = b.song.split(' - ')[1];
			return (c > d ? 1 : -1);
		});
		
		SONG.ALL_YEARS = {};
		SONG.ALL_SONGS.forEach(function(song){
			if(!SONG.ALL_YEARS[song.year]) SONG.ALL_YEARS[song.year] = [];
			SONG.ALL_YEARS[song.year].push(song);
		});
		SONG.ALL_YEARS = Object.keys(SONG.ALL_YEARS).map(function(key){ return {year: key, songs: SONG.ALL_YEARS[key]}; }).sort(function(a,b){
			return a.songs.length < b.songs.length;
		});
		
		var artists_button = '<div class="button button-half-sm float-right" onclick="all_artists();">'+
			data.length.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' artists' +
		'</div>';
		var songs_button = '<div class="button button-half-sm float-right" onclick="all_songs();">'+
			data.map(function(a){
				return a.songs.length;
			}).reduce(function(a,b){return a+b;	}).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " songs" +
		'</div>';
		var years_button = '<div class="button button-half-sm float-right" onclick="all_years();">'+SONG.ALL_YEARS.length+' years</div>';
	
		$(".header .hidden-sm").append(
			'<div class="button" onclick="random_artist();">RANDOM ARTIST</div>'+
			'<div class="button" onclick="random_songs(5);">5 RANDOM SONGS</div>'+
			'<div class="button" onclick="random_year();">RANDOM YEAR</div>'+
			artists_button + songs_button + years_button
		);
		$(".header .hidden-lg").append(
			artists_button + '<div class="button button-half-sm" onclick="random_artist();">ARTIST</div>'  +
			songs_button   + '<div class="button button-half-sm" onclick="random_songs(5);">5 SONGS</div>' + 
			years_button   + '<div class="button button-half-sm" onclick="random_year();">YEAR</div>'      
		);
		all_artists();
	}
});

function html_song(song){
	var query = encodeURIComponent((song.artist ? song.artist + " " : '') + song.song);
	var youtube_link = 'https://www.youtube.com/results?search_query='+query;
	// var youtube_link = 'https://www.google.com/#q='+query;
	var repeat_link  = 'http://youtubeonrepeat.com/results/?search_query='+query;
	return '<div class="song '+(song.playlist ? song.playlist : '')+'">'+
		(song.artist ? song.artist.toUpperCase() + ' - ' : '') + song.song +
		'<span class="year">(' + song.year + ')</span>' +
		'<br>'+
		'<a class="link" target="_blank" href="'+youtube_link+'"><i class="fa fa-youtube-play"></i></a>'+
		'<a class="link" target="_blank" href="'+repeat_link+'"><i class="fa fa-refresh"></i></a>'+
	'</div>';
};

function all_songs(){
	$("#content").html(SONG.ALL_SONGS.map(function(a){ return html_song(a); }).join(''));
};

function all_artists(){
	$("#content").html('');
	$("#content").html(
		SONG.data.map(function(a){
			return '<div class="artist" onclick="load_artist(&quot;'+(a.artist || a.playlist)+'&quot;);">'+
				'<div class="name">'+
					'<table>'+
						'<tr>'+
							'<td rowspan="6">'+(a.artist || a.playlist).toUpperCase()+'<hr></div>'+
						'</tr>'+
					'</table>'+
				'</div>'+
				'<div class="num-songs">'+
					'<table>'+
						'<tr><td class="number">'+a.songs.length+'</td></tr>'+
						(a.songs.length > 1 ? "SONGS" : "SONG").split('').map(function(b){ return '<tr><td>'+b+'</td></tr>'; }).join('')+
					'</table>'+
				'</div>'+
			'</div>';
		}).join('')
	);
};

function all_years(){
	$("#content").html('');
	$("#content").html(
		SONG.ALL_YEARS.map(function(a){
			return '<div class="artist" onclick="load_year(&quot;'+a.year+'&quot;);">'+
				'<div class="name">'+
					'<table>'+
						'<tr>'+
							'<td rowspan="6">'+a.year+'<hr></div>'+
						'</tr>'+
					'</table>'+
				'</div>'+
				'<div class="num-songs">'+
					'<table>'+
						'<tr><td class="number">'+a.songs.length+'</td></tr>'+
						(a.songs.length > 1 ? "SONGS" : "SONG").split('').map(function(b){ return '<tr><td>'+b+'</td></tr>'; }).join('')+
					'</table>'+
				'</div>'+
			'</div>';
		}).join('')
	);
};

function load_artist(artist){
	$("#content").html('');
	var matches = SONG.data.filter(function(a){ return (a.artist || a.playlist).toLowerCase() == artist.toLowerCase(); });
	if(matches.length){
		var songs = matches[0].songs.map(function(a){ 
			a.artist = matches[0].artist;
			a.playlist = matches[0].playlist;
			return a
		});
		$("#content").html(songs.map(function(a){ return html_song(a); }).join(''));
	}
};

function random_artist(){
	load_artist(SONG.data[Math.floor(Math.random()*SONG.data.length)].artist);
};

function random_songs(num){
	var results = [];
	var songs = SONG.ALL_SONGS.slice();
	for(var i=0; i<num; i++){
		results.push(songs.splice(Math.floor(Math.random()*songs.length), 1)[0]);
	}
	
	$("#content").html(results.map(function(a){ return html_song(a); }).join(''));
};

function load_year(year){
	$("#content").html('');
	var matches = SONG.ALL_SONGS.filter(function(a){ return year == a.year; });
	if(matches.length){
		$("#content").html(matches.map(function(a){ return html_song(a); }).join(''));
	}
};

function random_year(){
	load_year(SONG.ALL_YEARS[Math.floor(Math.random()*SONG.ALL_YEARS.length)].year);
};
</script>
</html>