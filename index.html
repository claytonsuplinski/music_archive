<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">  
	<meta name="author" content="Clayton Suplinski">
	<meta name="description" content="A collection of songs with links to their music videos.">
	
	<title>Music Archive</title>

	<link href="https://fonts.googleapis.com/css?family=Biryani:900" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">	
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
	
	<link rel="stylesheet" href="./assets/css/main.css">
</head>
<body>
<div class="header">
	<div class="hidden-sm hidden-xs"></div>
	<div class="hidden-md hidden-lg"></div>
</div>
<div id="content"></div>
</body>

<script src="./assets/lib/jquery.min.js"></script>

<script>
var SONG = {};
SONG.SORT = {
	songs   : {asc:  true, curr: 0, options: ['SONG', 'ARTIST', 'YEAR', 'STARS']},
	artists : {asc: false, curr: 0, options: ['# SONGS', 'NAME']},
	years   : {asc: false, curr: 0, options: ['# SONGS', 'YEAR']}
};

var LIMIT = {
	artists : 20,
	songs   : 50,
	years   : 20
};

$.ajax({
	url: './assets/data/songs.json',
	dataType: 'json',
	success: function(data){
		var now = new Date();
		
		var doy = now.getDay();
		var mth = now.getMonth();
		
		var friday_condition    = ( doy ==  5 );
		var halloween_condition = ( mth ==  9 );
		var christmas_condition = ( mth >= 10 );
		var nfl_condition       = ( [0,1,4].indexOf( doy ) != -1 && [7,8,9,10,11,0,1].indexOf( mth ) != -1 );
		var ncaaf_condition     = ( [5,6].indexOf( doy ) != -1 && [7,8,9,10,11,0].indexOf( mth ) != -1 );
		
		data = data.filter(function(a){
			return a.artist ||
				(a.playlist == "Friday" && friday_condition) ||
				(a.playlist == "Christmas" && christmas_condition) ||
				(a.playlist == "Halloween" && halloween_condition) ||
				( ['Badgers'].indexOf( a.playlist ) != -1 && ncaaf_condition ) || 
				( ['Steelers', 'Packers'].indexOf( a.playlist ) != -1 && nfl_condition ); 
		});
		
		data.forEach(function(a){
			if(!a.artist && a.playlist) a.artist = a.playlist;
		});
		
		data.sort(function(a, b){
			var a_l = a.artist.toLowerCase();
			var b_l = b.artist.toLowerCase();
			return (a_l > b_l ? 1 : -1);
		});
		SONG.data = data;
		data.sort(function(a, b){
			return (a.songs.length < b.songs.length ? 1 : -1);
		});
		
		SONG.ALL_SONGS = SONG.data.map(function(a){ return a.songs.map(function(b){
			b.artist = a.artist;
			b.playlist = a.playlist;
			if(a.playlist){
				var song_parts = b.song.split(' - ');
				b.artist_only = song_parts[0];
				b.song_only = song_parts[1];
			}
			return b;
		}); });
		
		SONG.ALL_SONGS = [].concat.apply([], SONG.ALL_SONGS).sort(function(a, b){
			var c = a.song;
			var d = b.song;
			if(a.playlist) c = a.song.split(' - ')[1];
			if(b.playlist) d = b.song.split(' - ')[1];
			return (c > d ? 1 : -1);
		});
		
		SONG.ALL_YEARS = {};
		SONG.ALL_SONGS.forEach(function(song){
			if(!SONG.ALL_YEARS[song.year]) SONG.ALL_YEARS[song.year] = [];
			SONG.ALL_YEARS[song.year].push(song);
		});
		SONG.ALL_YEARS = Object.keys(SONG.ALL_YEARS).map(function(key){ return {year: key, songs: SONG.ALL_YEARS[key]}; }).sort(function(a,b){
			return a.songs.length < b.songs.length;
		});
		
		var artists_button = '<div class="button button-half-sm float-right" onclick="all_artists(' + LIMIT.artists + ');">'+
			data.length.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' artists' +
		'</div>';
		var songs_button = '<div class="button button-half-sm float-right" onclick="all_songs(' + LIMIT.songs + ');">'+
			data.map(function(a){
				return a.songs.length;
			}).reduce(function(a,b){return a+b;	}).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + " songs" +
		'</div>';
		var years_button = '<div class="button button-half-sm float-right" onclick="all_years(' + LIMIT.years + ');">' + 
			SONG.ALL_YEARS.length + 
		' years</div>';
	
		$(".header .hidden-sm").html(
			'<div class="button" onclick="random_artist();">RANDOM ARTIST</div>'+
			'<div class="button" onclick="random_songs(5);">5 RANDOM SONGS</div>'+
			'<div class="button" onclick="random_year();">RANDOM YEAR</div>'+
			artists_button + songs_button + years_button
		);
		$(".header .hidden-lg").html(
			artists_button + '<div class="button button-half-sm" onclick="random_artist();">ARTIST</div>'  +
			songs_button   + '<div class="button button-half-sm" onclick="random_songs(5);">5 SONGS</div>' + 
			years_button   + '<div class="button button-half-sm" onclick="random_year();">YEAR</div>'      
		);
		all_artists( LIMIT.artists );
	}
});

function html_song(song){
	var query = encodeURIComponent((song.artist && !song.playlist ? song.artist + " " : '') + song.song);
	var youtube_link = 'https://www.youtube.com/results?search_query='+query;
	var google_link  = 'https://www.google.com/#q='+query;
	var repeat_link  = 'http://reppeat.com/results/?search_query='+query;
	return '<div class="song '+(song.playlist ? song.playlist : '')+'">'+
		'<a class="info-link" href="'+google_link+'" target="_blank"><i class="fa fa-info-circle"></i></a> '+
		(song.artist && !song.playlist ? song.artist.toUpperCase() + ' - ' : '') + song.song +
		'<span class="year">(' + song.year + ')</span>' +
		( song.stars ? 
			'<span class="stars ' + ( song.stars >= 6 ? 'six' : '' ) + '">' + 
				Array.apply( null, { length : song.stars } ).map( s => '<i class="fa fa-star"></i>' ).join('') + 
			'</span>' 
			: '' ) +
		'<br>'+
		'<a class="link" target="_blank" href="'+youtube_link+'"><i class="fa fa-youtube-play"></i></a>'+
		'<a class="link" target="_blank" href="'+repeat_link+'"><i class="fa fa-refresh"></i></a>'+
	'</div>';
};

function all_songs( limit ){
	var songs = SONG.ALL_SONGS.slice();
	var curr_sort_type  = SONG.SORT.songs.options[SONG.SORT.songs.curr];
	songs.sort(function(a,b){
		switch(curr_sort_type){
			case 'SONG':
				return (SONG.SORT.songs.asc ? 1 : -1) * ( (a.song_only || a.song).toUpperCase() > (b.song_only || b.song).toUpperCase() ? 1 : -1);
			case 'ARTIST':          
				return (SONG.SORT.songs.asc ? 1 : -1) * ( (a.artist_only || a.artist).toUpperCase() > (b.artist_only || b.artist).toUpperCase() ? 1 : -1);
			case 'YEAR':          
				return (SONG.SORT.songs.asc ? 1 : -1) * (a.year > b.year ? 1 : -1);
			case 'STARS':
				return (SONG.SORT.songs.asc ? 1 : -1) * ( (a.stars || 0) > (b.stars || 0) ? 1 : -1);
		}
	});
	
	if( limit ) songs = songs.slice( 0, limit );
	
	var toggle_sort_order = 'SONG.SORT.songs.asc = !SONG.SORT.songs.asc;';
	var toggle_sort_type  = 'SONG.SORT.songs.curr++;'+
		'SONG.SORT.songs.curr %= SONG.SORT.songs.options.length;';
	$("#content").html(
		'<div class="header">'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_order+'all_songs();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+(SONG.SORT.songs.asc ? 'ASC' : 'DESC')+
			'</div>'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_type+'all_songs();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+curr_sort_type+
			'</div>'+
		'</div>'+
		songs.map(function(a){ return html_song(a); }).join('') +
		( limit ? '<div class="button button-1" onclick="all_songs();">ALL SONGS</div>' : '' )
	);
};

function all_artists( limit ){
	var artists = SONG.data.slice();
	var curr_sort_type  = SONG.SORT.artists.options[SONG.SORT.artists.curr];
	artists.sort(function(a,b){
		return ( a.artist.toUpperCase() > b.artist.toUpperCase() ? -1 : 1);
	});
	artists.sort(function(a,b){
		switch(curr_sort_type){
			case '# SONGS':
				return (SONG.SORT.artists.asc ? 1 : -1) * (a.songs.length > b.songs.length ? 1 : -1);
			case 'NAME':          
				return (SONG.SORT.artists.asc ? 1 : -1) * (a.artist.toUpperCase() > b.artist.toUpperCase() ? 1 : -1);
		}
	});
	
	if( limit ) artists = artists.slice( 0, limit );
	
	var toggle_sort_order = 'SONG.SORT.artists.asc = !SONG.SORT.artists.asc;';
	var toggle_sort_type  = 'SONG.SORT.artists.curr++;'+
		'SONG.SORT.artists.curr %= SONG.SORT.artists.options.length;';
	$("#content").html('');
	$("#content").html(
		'<div class="header">'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_order+'all_artists();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+(SONG.SORT.artists.asc ? 'ASC' : 'DESC')+
			'</div>'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_type+'all_artists();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+curr_sort_type+
			'</div>'+
		'</div>'+
		artists.map(function(a){
			return '<div class="artist" onclick="load_artist(&quot;'+a.artist+'&quot;);">'+
				'<div class="name">'+
					'<table>'+
						'<tr>'+
							'<td rowspan="6">'+a.artist.toUpperCase()+'<hr></div>'+
						'</tr>'+
					'</table>'+
				'</div>'+
				'<div class="num-songs">'+
					'<table>'+
						'<tr><td class="number">'+a.songs.length+'</td></tr>'+
						(a.songs.length > 1 ? "SONGS" : "SONG").split('').map(function(b){ return '<tr><td>'+b+'</td></tr>'; }).join('')+
					'</table>'+
				'</div>'+
			'</div>';
		}).join('') +
		( limit ? '<div class="button button-1" onclick="all_artists();">ALL ARTISTS</div>' : '' )
	);
};

function all_years( limit ){
	var years = SONG.ALL_YEARS.slice();
	var curr_sort_type  = SONG.SORT.years.options[SONG.SORT.years.curr];
	years.sort(function(a,b){
		switch(curr_sort_type){
			case '# SONGS':
				return (SONG.SORT.years.asc ? 1 : -1) * (a.songs.length > b.songs.length ? 1 : -1);
			case 'YEAR':
				return (SONG.SORT.years.asc ? 1 : -1) * (a.year > b.year ? 1 : -1);
		}
	});
	
	if( limit ) years = years.slice( 0, limit );
	
	var toggle_sort_order = 'SONG.SORT.years.asc = !SONG.SORT.years.asc;';
	var toggle_sort_type  = 'SONG.SORT.years.curr++;'+
		'SONG.SORT.years.curr %= SONG.SORT.years.options.length;';
	$("#content").html('');
	$("#content").html(
		'<div class="header">'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_order+'all_years();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+(SONG.SORT.years.asc ? 'ASC' : 'DESC')+
			'</div>'+
			'<div class="button button-2 button-half-sm" onclick="'+toggle_sort_type+'all_years();">'+
				'<i class="fa fa-sort-amount-asc"></i> '+curr_sort_type+
			'</div>'+
		'</div>'+
		years.map(function(a){
			return '<div class="artist" onclick="load_year(&quot;'+a.year+'&quot;);">'+
				'<div class="name">'+
					'<table>'+
						'<tr>'+
							'<td rowspan="6">'+a.year+'<hr></div>'+
						'</tr>'+
					'</table>'+
				'</div>'+
				'<div class="num-songs">'+
					'<table>'+
						'<tr><td class="number">'+a.songs.length+'</td></tr>'+
						(a.songs.length > 1 ? "SONGS" : "SONG").split('').map(function(b){ return '<tr><td>'+b+'</td></tr>'; }).join('')+
					'</table>'+
				'</div>'+
			'</div>';
		}).join('') +
		( limit ? '<div class="button button-1" onclick="all_years();">ALL YEARS</div>' : '' )
	);
};

function load_artist(artist){
	$("#content").html('');
	var matches = SONG.data.filter(function(a){ return a.artist.toLowerCase() == artist.toLowerCase(); });
	if(matches.length){
		var songs = matches[0].songs.map(function(a){ 
			a.artist = matches[0].artist;
			a.playlist = matches[0].playlist;
			return a
		});
		$("#content").html(songs.map(function(a){ return html_song(a); }).join(''));
	}
};

function random_artist(){
	load_artist(SONG.data[Math.floor(Math.random()*SONG.data.length)].artist);
};

function random_songs(num){
	var results = [];
	var songs = SONG.ALL_SONGS.slice();
	for(var i=0; i<num; i++){
		results.push(songs.splice(Math.floor(Math.random()*songs.length), 1)[0]);
	}
	
	$("#content").html(results.map(function(a){ return html_song(a); }).join(''));
};

function load_year(year){
	$("#content").html('');
	var matches = SONG.ALL_SONGS.filter(function(a){ return year == a.year; });
	if(matches.length){
		$("#content").html(matches.map(function(a){ return html_song(a); }).join(''));
	}
};

function random_year(){
	load_year(SONG.ALL_YEARS[Math.floor(Math.random()*SONG.ALL_YEARS.length)].year);
};
</script>
</html>